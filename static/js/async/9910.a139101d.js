"use strict";(self.webpackChunk_cmtlyt_toolset=self.webpackChunk_cmtlyt_toolset||[]).push([["9910"],{9358:function(e,t,n){n.r(t),n.d(t,{default:function(){return u}});var r=n(2676),i=n(453),o=n(371),s=n(2287);function l(e){let t=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",ul:"ul",li:"li",code:"code",ol:"ol",h3:"h3",strong:"strong",blockquote:"blockquote",details:"details",summary:"summary",div:"div",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td"},(0,i.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.h1,{id:"性能优化指标",children:[(0,r.jsx)(t.a,{className:"header-anchor","aria-hidden":"true",href:"#性能优化指标",children:"#"}),"性能优化指标"]}),"\n",(0,r.jsx)(s.Z,{defaultLocale:"zh-CN"}),"\n",(0,r.jsxs)(t.h2,{id:"引言",children:[(0,r.jsx)(t.a,{className:"header-anchor","aria-hidden":"true",href:"#引言",children:"#"}),"引言"]}),"\n",(0,r.jsx)(t.p,{children:"性能优化是老生常谈的话题了, 但是我们要做性能优化的前提是什么呢?"}),"\n",(0,r.jsx)(t.p,{children:"当然是量化性能的标准了啊, 无法量化, 那又何来的优化呢?"}),"\n",(0,r.jsx)(t.p,{children:"那现在的问题就是如何量化了, 靠体感嘛, 肯定不现实啊, 不同设备, 在不同环境, 不同时间都会有不同的性能表现, 而且体感的阈值也会比较大, 特别明显的才会感觉到"}),"\n",(0,r.jsx)(t.p,{children:"在这个话题上业界也经过多年的实践, 尝试过许多量化用户体验的方式, 例如"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"测量页面白屏时长"}),"\n",(0,r.jsx)(t.li,{children:"计算可交互耗时 (Time to interact)"}),"\n",(0,r.jsx)(t.li,{children:"计算总阻塞时间 (Total blocking time, TBT)"}),"\n",(0,r.jsx)(t.li,{children:"计算首次有效绘制 (First Meaningful paint, FMP)"}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"这些指标往往逻辑复杂、难以测量, 甚至定义都有歧义, 所以逐渐消亡"}),"\n",(0,r.jsxs)(t.p,{children:["经过大浪淘沙, 近年来近年来最实用的用户体验量化指标是基于开源库 ",(0,r.jsx)(t.a,{href:"https://github.com/GoogleChrome/web-vitals",rel:"noopener noreferrer",target:"_blank",children:"web-vitals"})," 获取页面渲染耗时, 交互延迟等指标"]}),"\n",(0,r.jsxs)(t.h2,{id:"web-vitals-各指标简介",children:[(0,r.jsx)(t.a,{className:"header-anchor","aria-hidden":"true",href:"#web-vitals-各指标简介",children:"#"}),"web-vitals 各指标简介"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"web-vitals"})," 是谷歌的 Chrome 维护团队于 2020 年开源的工具库, 它基于统一的浏览器 Performance API 获取标准化的用户体验指标"]}),"\n",(0,r.jsx)(t.p,{children:"它主要测量6项指标, 分别是"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"首次内容绘制 (First Contentful Paint, FCP)"}),"\n",(0,r.jsx)(t.li,{children:"最大内容绘制 (Largest Contentful Paint, LCP)"}),"\n",(0,r.jsx)(t.li,{children:"首次输入延迟 (First Input Delay , FID)"}),"\n",(0,r.jsx)(t.li,{children:"交互到绘制延迟（Interaction to Next Paint, INP）"}),"\n",(0,r.jsx)(t.li,{children:"累积布局偏移 (Cumulative Layout Shift, CLS)"}),"\n",(0,r.jsx)(t.li,{children:"第一字节时间 (Time to First Byte, TTFB)"}),"\n"]}),"\n",(0,r.jsxs)(t.h3,{id:"1-首次内容绘制-first-contentful-paint-fcp",children:[(0,r.jsx)(t.a,{className:"header-anchor","aria-hidden":"true",href:"#1-首次内容绘制-first-contentful-paint-fcp",children:"#"}),"1. 首次内容绘制 (First Contentful Paint, FCP)"]}),"\n",(0,r.jsxs)(t.p,{children:["FCP 测量从页面开始加载到页面中任意部分内容 (文本、图像、",(0,r.jsx)(t.code,{children:"svg"}),"、",(0,r.jsx)(t.code,{children:"canvas"})," 等内容) 完成渲染的时长"]}),"\n",(0,r.jsx)(t.p,{children:"其值为浮点数, 单位是毫秒. FCP 值越小表示该指标状况越好、页面的厨师内容渲染越快"}),"\n",(0,r.jsx)(t.p,{children:"页面中率先出现的文本图像等视觉可见内容, 直接决定了用户对页面加载速度的主观体验, 所以这一指标选择测量这些内容的渲染耗时, 从而量化用户的主管体验"}),"\n",(0,r.jsxs)(t.p,{children:["注意, FCP 测量的是",(0,r.jsx)(t.strong,{children:"任意部分"})," DOM 完成渲染的耗时, 而非",(0,r.jsx)(t.strong,{children:"全部"}),"内容完成渲染耗时, 不等于 ",(0,r.jsx)(t.code,{children:"onLoad"})," 事件"]}),"\n",(0,r.jsx)(t.p,{children:"按照 Chrome 官方的推荐标准, FCP 指标分为 3 个等级"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"优: 小于 1.8 秒"}),"\n",(0,r.jsx)(t.li,{children:"待改进: 大于 1.8 秒且小于 3 秒"}),"\n",(0,r.jsx)(t.li,{children:"差: 大于 3 秒"}),"\n"]}),"\n",(0,r.jsxs)(t.h3,{id:"2-最大内容绘制-largest-contentful-paint-lcp",children:[(0,r.jsx)(t.a,{className:"header-anchor","aria-hidden":"true",href:"#2-最大内容绘制-largest-contentful-paint-lcp",children:"#"}),"2. 最大内容绘制 (Largest Contentful Paint, LCP)"]}),"\n",(0,r.jsxs)(t.p,{children:["LCP 测量从页面开始加载到可视区域内",(0,r.jsx)(t.strong,{children:"尺寸最大"}),"的文字或图像渲染完成的耗时"]}),"\n",(0,r.jsx)(t.p,{children:"其值为浮点数, 单位是毫秒. LCP 值越小表示该指标状况越好、最大元素渲染越快"}),"\n",(0,r.jsx)(t.p,{children:"之所以测量最大的内容, 是因为尺寸最大的内容往往是最能吸引用户的注意力, 其渲染耗时, 直接影响了用户对页面整体渲染速度的体验"}),"\n",(0,r.jsx)(t.p,{children:"我们可以用 Chrome 浏览器自带的 DevTool 中的 Performance Insights 工具来判断页面中什么元素是最大内容"}),"\n",(0,r.jsx)(t.p,{children:"按照 Chrome 官方的推荐标准, LCP 指标分为 3 个等级"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"优: 小于 2.5 秒"}),"\n",(0,r.jsx)(t.li,{children:"待改进: 大于 2.5 秒且小于 4 秒"}),"\n",(0,r.jsx)(t.li,{children:"差: 大于 4 秒"}),"\n"]}),"\n",(0,r.jsxs)(t.h3,{id:"3-首次输入延迟-first-input-delay--fid",children:[(0,r.jsx)(t.a,{className:"header-anchor","aria-hidden":"true",href:"#3-首次输入延迟-first-input-delay--fid",children:"#"}),"3. 首次输入延迟 (First Input Delay , FID)"]}),"\n",(0,r.jsx)(t.p,{children:"FID 测量用户首次交互 (点击、触摸) 后到浏览器开始响应之间的时间剪个"}),"\n",(0,r.jsx)(t.p,{children:"其值为浮点数, 单位是毫秒. FID 值越小表示该指标状况越好, 用户首次与页面交互式, 浏览器响应的延迟学校"}),"\n",(0,r.jsx)(t.p,{children:"这一指标只关注页面中首次交互的原因是, 首次交互时, 页面汪汪楚玉尚未完全加载的状态, 异步响应数据在等待响应、部分 JS 和 CSS 仍在执行和渲染的过程中, 浏览器的主线成灰短暂的处于忙碌状态, 往往不能及时响应用户交互"}),"\n",(0,r.jsx)(t.p,{children:"但是第一次交互的延迟长短往往决定了用户对网页流畅度的第一印象, 所以这一指标的测量目标, 也能量化用户的主观体验"}),"\n",(0,r.jsx)(t.p,{children:"按照 Chrome 官方的推荐标准, FID 指标分为 3 等级:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"优: 小于 100 毫秒"}),"\n",(0,r.jsx)(t.li,{children:"待改进: 大于 100 毫秒且小于 300 毫秒"}),"\n",(0,r.jsx)(t.li,{children:"差: 大于 300 毫秒"}),"\n"]}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"FID 指标与下文将要提到的 INP 指标测量目标有所重叠, 且普适性不及 INP, 未来可能会被 INP 替代"}),"\n"]}),"\n",(0,r.jsxs)(t.details,{className:"rspress-directive details",children:[(0,r.jsx)(t.summary,{className:"rspress-directive-title",children:"扩展知识 (普适性)"}),(0,r.jsxs)(t.div,{className:"rspress-directive-content",children:[(0,r.jsx)(t.p,{children:"普适性 (Universality) 是指某种特性、原则或规律在广泛的条件下都适用或存在的性质. 这个概念可以用于多个领域, 如数学、物理学、计算机科学以及社会学等"}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"数学中的普适性: 不了解"}),"\n",(0,r.jsx)(t.li,{children:"物理学中的普适性: 不了解"}),"\n",(0,r.jsx)(t.li,{children:"计算机科学中的普适性: 图灵机模型展示了计算机的本质, 理论上他可以模拟任何其他计算模型的能力, 这种能力被称为计算机的普适性"}),"\n",(0,r.jsx)(t.li,{children:"社会学中的普适性: 虽然文化背景和社会环境对人们的行为有很大影响, 但有些基本的人类行为模式或者心理特征被认为是跨文化的, 例如亲情关系的重要性、对安全的需求等"}),"\n"]}),(0,r.jsxs)(t.p,{children:["需要注意, 普适性并不意味着",(0,r.jsx)(t.strong,{children:"完全无例外"}),"地适用于每一个案例: 而是指在一个广泛范围内具有高度的一致性和适用性, 在实际应用时, 还需要考虑具体情况下的特殊因素"]})]})]}),"\n",(0,r.jsxs)(t.h3,{id:"4-交互到绘制延迟interaction-to-next-paint-inp",children:[(0,r.jsx)(t.a,{className:"header-anchor","aria-hidden":"true",href:"#4-交互到绘制延迟interaction-to-next-paint-inp",children:"#"}),"4. 交互到绘制延迟（Interaction to Next Paint, INP）"]}),"\n",(0,r.jsxs)(t.p,{children:["INP 测量用户在页面浏览过程中的所有交互 (点击、键盘输入、触摸等) 与浏览器渲染响应的",(0,r.jsx)(t.strong,{children:"整体"}),"延迟情况"]}),"\n",(0,r.jsx)(t.p,{children:"其值为浮点数, 单位是毫秒. INP 值越小表示该指标状况越好, 用户的各类交互响应延迟减小"}),"\n",(0,r.jsxs)(t.p,{children:["与 FID 只关注首次交互不同, INP 会关注用户浏览网页全过程中的",(0,r.jsx)(t.strong,{children:"所有"}),"交互, 所以 ",(0,r.jsx)(t.code,{children:"web-vitals"})," 库中获取 INP 值的 ",(0,r.jsx)(t.code,{children:"onINP(FCPReportCallback)"})," 方法, 通常会在页面可视化状态变化或页面卸载时多次触发, 综合统计一段时间内的多次交互, 按特定算法, 计算该时间段内的 INP 指标值"]}),"\n",(0,r.jsx)(t.p,{children:"INP 指标 3 个等级的评分分别为:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"优: 小于 200 毫秒"}),"\n",(0,r.jsx)(t.li,{children:"待改进: 大于 200 毫秒且小于 500 毫秒"}),"\n",(0,r.jsx)(t.li,{children:"差: 大于 500 毫秒"}),"\n"]}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsxs)(t.p,{children:["INP 是新进加入 ",(0,r.jsx)(t.code,{children:"web-vitals"})," 的指标, 仍处于试验阶段, 其标准可能会有调整, 目前描述的是其 2023 年 5 月的状况"]}),"\n"]}),"\n",(0,r.jsxs)(t.h3,{id:"5-累积布局偏移-cumulative-layout-shift-cls",children:[(0,r.jsx)(t.a,{className:"header-anchor","aria-hidden":"true",href:"#5-累积布局偏移-cumulative-layout-shift-cls",children:"#"}),"5. 累积布局偏移 (Cumulative Layout Shift, CLS)"]}),"\n",(0,r.jsxs)(t.p,{children:["CLS 测量页面中所有",(0,r.jsx)(t.strong,{children:"意外"}),"布局变化的累计分值"]}),"\n",(0,r.jsxs)(t.p,{children:["其值为浮点数, ",(0,r.jsx)(t.strong,{children:"无单位"}),", 值的大小表示意外布局变化的多少和影响范围的大小"]}),"\n",(0,r.jsx)(t.p,{children:"CLS 值的计算类似 INP, 会统计一段时间内的所有意外布局变化, 按特定算法, 计算出分值"}),"\n",(0,r.jsxs)(t.p,{children:["所谓",(0,r.jsx)(t.strong,{children:"意外布局变化"}),"是指 DOM 元素在前后绘制的 2 帧之间, 非用户交互引起的 DOM 元素尺寸、位置变化"]}),"\n",(0,r.jsx)(t.p,{children:"按照Chrome官方的推荐标准, CLS指标3个等级的评分分别为："}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"优：小于 0.1"}),"\n",(0,r.jsx)(t.li,{children:"待改进：大于 0.1 且小于 0.25"}),"\n",(0,r.jsx)(t.li,{children:"差：大于 0.25"}),"\n"]}),"\n",(0,r.jsxs)(t.h3,{id:"6-第一字节时间-time-to-first-byte-ttfb",children:[(0,r.jsx)(t.a,{className:"header-anchor","aria-hidden":"true",href:"#6-第一字节时间-time-to-first-byte-ttfb",children:"#"}),"6. 第一字节时间 (Time to First Byte, TTFB)"]}),"\n",(0,r.jsx)(t.p,{children:"TTFB 测量前端页面 (Document) 的 HTTP 请求发送后, 到接收到第一个字节数据响应的耗时, 通常包括重定向、DNS 查询、服务器响应延迟等耗时"}),"\n",(0,r.jsx)(t.p,{children:"其值为浮点数, 单位是毫秒. 值越小表示该值状态越好, 页面 HTTP 响应的耗时越短, 也就是页面的加载更快"}),"\n",(0,r.jsxs)(t.p,{children:["TTFB 指标值的大小直接决定着页面厨师内容渲染耗时的长短, 往往和 ",(0,r.jsx)(t.code,{children:"FCP"}),"、",(0,r.jsx)(t.code,{children:"LCP"})," 指标有明显的相关关系, 对用户体验又直接影响, 所以 ",(0,r.jsx)(t.code,{children:"web-viatals"})," 也将其当作了量化用户体验的指标之一"]}),"\n",(0,r.jsxs)(t.p,{children:["除了可以通过 ",(0,r.jsx)(t.code,{children:"web-vitals"})," 库的 ",(0,r.jsx)(t.code,{children:"onTTFB()"})," API 获取, 也可以使用 Chrome 自带的 DevTool Network 网络面板计算得出: ",(0,r.jsx)(t.code,{children:"文档响应的整体耗时 减去 内容下载耗时（Content Download"})]}),"\n",(0,r.jsx)(t.p,{children:"TTFB指标3个等级的评分分别为："}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"优：小于 800 毫秒"}),"\n",(0,r.jsx)(t.li,{children:"待改进：大于 800 毫秒且小于 1800 毫秒"}),"\n",(0,r.jsx)(t.li,{children:"差：大于 1800 毫秒"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["尽管以上指标可以通过与原生 Performance API 计算获得, 但仍然推荐使用 ",(0,r.jsx)(t.code,{children:"web-vitals"})," 库, 因为它帮助我们处理了许多细节问题, 例如标签页处于后台时的计算、指标获取时机、浏览器兼容性等等, 能确保我们测量出标准、稳定的指标数值"]}),"\n",(0,r.jsxs)(t.h2,{id:"6-类指标对比",children:[(0,r.jsx)(t.a,{className:"header-anchor","aria-hidden":"true",href:"#6-类指标对比",children:"#"}),"6 类指标对比"]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"名称"}),(0,r.jsx)(t.th,{children:"含义"}),(0,r.jsx)(t.th,{children:"注意事项"}),(0,r.jsx)(t.th,{children:"值单位"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"首次内容绘制(First Contentful Paint, FCP)"}),(0,r.jsx)(t.td,{children:"测量从页面开始加载到页面中任意部分内容（文本、图像、<svg/>、<canvas/>等内容）完成渲染的时长"}),(0,r.jsx)(t.td,{children:"测量任意部分DOM渲染的耗时, 而非全部内容, 不等于页面所有内容完全加载完成的onLoad事件"}),(0,r.jsx)(t.td,{children:"毫秒"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"最大内容绘制 (Largest Contentful Paint, LCP)"}),(0,r.jsx)(t.td,{children:"测量从页面开始加载到可视区域内尺寸最大的文字或图像渲染完成的耗时"}),(0,r.jsx)(t.td,{children:"对于UI渲染逻辑复杂的前端应用, 不同优化可能会有不同的最大元素, 统计获得的最大元素可能有多个"}),(0,r.jsx)(t.td,{children:"毫秒"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"首次输入延迟(First Input Delay , FID)"}),(0,r.jsx)(t.td,{children:"测量用户首次交互（点击、触摸）后到浏览器开始响应用户交互之间的时间间隔"}),(0,r.jsx)(t.td,{children:"未来可能会被INP替代"}),(0,r.jsx)(t.td,{children:"毫秒"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"交互到绘制延迟(Interaction to Next Paint, INP)"}),(0,r.jsx)(t.td,{children:"测量用户在页面浏览过程中的所有交互（点击、键盘输入、触摸等）与浏览器绘制对应响应的整体延迟情况"}),(0,r.jsx)(t.td,{children:"通常会在页面可视化状态变化或页面卸载时进行计算"}),(0,r.jsx)(t.td,{children:"毫秒"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"累积布局偏移(Cumulative Layout Shift, CLS)"}),(0,r.jsx)(t.td,{children:"测量页面中, 一定时间段内所有意外布局变化的累计分值"}),(0,r.jsx)(t.td,{children:"- 通常会在页面可视化状态变化或页面卸载时进行计算 - web-viatals提供的onCLS()方法会多次触发 - onCLS()获取到的sources字段可能会因为元素卸载而变成null, 统计时可以使用xpath进行特殊处理"}),(0,r.jsx)(t.td,{children:"分值"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"第一字节时间(Time to First Byte, TTFB)"}),(0,r.jsx)(t.td,{children:"测量页面本身 (Document) 的HTTP请求发送后, 到接收到第一字节数据响应的耗时"}),(0,r.jsx)(t.td,{children:"往往和FCP、LCP指标有相关关系"}),(0,r.jsx)(t.td,{children:"毫秒"})]})]})]}),"\n",(0,r.jsxs)(t.h2,{id:"web-vitals-库使用示例",children:[(0,r.jsx)(t.a,{className:"header-anchor","aria-hidden":"true",href:"#web-vitals-库使用示例",children:"#"}),(0,r.jsx)(t.code,{children:"web-vitals"})," 库使用示例"]}),"\n",(0,r.jsxs)(t.p,{children:["以上 6 项均可通过 ",(0,r.jsx)(t.code,{children:"web-vitals"})," 库内置的 API 方便的获取, 将 ",(0,r.jsx)(t.code,{children:"web-vitals"})," 库集成到用户访问的前端页面, 即可方便的获取用户的真实体验数据, 例如:"]}),"\n",(0,r.jsx)(o.Z,{code:"import { useState, useEffect } from 'react'\nimport { onFCP, onLCP, onFID, onCLS, onINP, onTTFB } from 'web-vitals';\n\nexport default function App() {\n  const [data, setData] = useState({});\n\n  function onGetWebVitalsData(data) {\n    console.log(data);\n    if (!data?.name) return;\n    const name = data.name;\n    const value = data.value;\n    const rating = data.rating;\n    const msg = `value=${value}, rating=${rating}`;\n    setData((value) => ({ ...value, [name]: msg }));\n  }\n\n  useEffect(() => {\n    onFCP(onGetWebVitalsData);\n    onLCP(onGetWebVitalsData);\n    onFID(onGetWebVitalsData);\n    onCLS(onGetWebVitalsData);\n    onINP(onGetWebVitalsData);\n    onTTFB(onGetWebVitalsData);\n  }, [])\n\n  return (\n    <div>\n      <h2>FCP: {data.FCP || ''}</h2>\n      <h2>LCP: {data.LCP || ''}</h2>\n      <h2>TTFB: {data.TTFB || ''}</h2>\n      <p>首次交互（例如：点击任意位置）后可获取：</p>\n      <h2>FID: {data.FID || ''}</h2>\n      <p>页面可视化状态变化为隐藏（例如：切换标签页）后可获取：</p>\n      <h2>INP: {data.INP || ''}</h2>\n      <h2>CLS: {data.CLS || ''}</h2>\n      <a href=\"https://github.com/cmtlyt\" target=\"_blank\">Author: cmtlyt</a>\n    </div>\n  );\n}",language:"jsx",direction:"",editorPosition:"left"}),"\n",(0,r.jsx)(t.p,{children:"要注意的细节是, 这些指标中:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"onFCP, onTTFB 均在页面初始化是自动触发"}),"\n",(0,r.jsx)(t.li,{children:"onFID 是在用户第一次与页面交互时触发"}),"\n",(0,r.jsx)(t.li,{children:"onCLS, onINP 则因为要测量页面的全生命周期, 往往无固定触发时间点, 在实践中通常会在交互停止一段时间后, 或页面可是状态变化 (例如切换标签页) 后多次触发"}),"\n",(0,r.jsxs)(t.li,{children:["onLCP 的触发分 2 种情况","\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"如果有用户交互, 例如点击、按下按键、会立刻触发 onLCP 回调"}),"\n",(0,r.jsx)(t.li,{children:"如果始终没有用户交互, 则会在页面标签页切换到后台时触发 onLCP 回调"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"web-vitals"})," 这些指标是 Chrome 维护团队基于海量用户数据, 经过大量实践后设计出来的, 能科学的将主观的用户体验量化为客观的指标, 是我们进行体验优化的必备工具"]}),"\n",(0,r.jsxs)(t.p,{children:["大量的收集这些指标数据, 加上汇总分析便可以实现针对用户体验的“真实用户监控”, 从用户客户端收集到",(0,r.jsx)(t.strong,{children:"海量"}),"数据, 要比我们在内部的测试开发环境上测量出的",(0,r.jsx)(t.strong,{children:"少量"}),"数据更全面、更客观、更有说服力, 更有助于我们作出数据驱动的优化策略"]})]})}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:t}=Object.assign({},(0,i.ah)(),e.components);return t?(0,r.jsx)(t,Object.assign({},e,{children:(0,r.jsx)(l,e)})):l(e)}let u=a;a.__RSPRESS_PAGE_META={},a.__RSPRESS_PAGE_META["wiki%2F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%2Fweb-vitals.mdx"]={toc:[{id:"引言",text:"引言",depth:2},{id:"web-vitals-各指标简介",text:"web-vitals 各指标简介",depth:2},{id:"1-首次内容绘制-first-contentful-paint-fcp",text:"1. 首次内容绘制 (First Contentful Paint, FCP)",depth:3},{id:"2-最大内容绘制-largest-contentful-paint-lcp",text:"2. 最大内容绘制 (Largest Contentful Paint, LCP)",depth:3},{id:"3-首次输入延迟-first-input-delay--fid",text:"3. 首次输入延迟 (First Input Delay , FID)",depth:3},{id:"4-交互到绘制延迟interaction-to-next-paint-inp",text:"4. 交互到绘制延迟（Interaction to Next Paint, INP）",depth:3},{id:"5-累积布局偏移-cumulative-layout-shift-cls",text:"5. 累积布局偏移 (Cumulative Layout Shift, CLS)",depth:3},{id:"6-第一字节时间-time-to-first-byte-ttfb",text:"6. 第一字节时间 (Time to First Byte, TTFB)",depth:3},{id:"6-类指标对比",text:"6 类指标对比",depth:2},{id:"web-vitals-库使用示例",text:"`web-vitals` 库使用示例",depth:2}],title:"性能优化指标",frontmatter:{}}},1713:function(e,t,n){n.r(t),n.d(t,{Calculator:function(){return ne},EMPTY:function(){return v},STATIC_TYPE:function(){return y},arrayBufferToBase64String:function(){return ev},arrayBufferToChunkBase64String:function(){return em},arrayBufferToStream:function(){return eA},asyncFilter:function(){return ef},asyncReplace:function(){return eh},base64StringToStream:function(){return eP},base64StringToUint8Array:function(){return ey},binaryToString:function(){return e_},blobToChunkBase64String:function(){return eS},cacheByReturn:function(){return m},caniuse:function(){return et},caniuseCSSFeature:function(){return ee},chunkBase64StringToArrayBuffer:function(){return ex},chunkBase64StringToBlob:function(){return ew},chunkBase64StringToStream:function(){return ek},chunkTask:function(){return eK},clipboard:function(){return nd},cloneMerge:function(){return eu},compose:function(){return e$},cookie:function(){return nh},createLinkByString:function(){return eW},createPool:function(){return nT},createUploader:function(){return rc},createWorkerFunc:function(){return nI},curry:function(){return w},debounce:function(){return eV},deepClone:function(){return el},formatDate:function(){return ec},gc:function(){return eB},generateClassName:function(){return eN},generateCookieInfo:function(){return eF},getAliAppEnv:function(){return W},getArray:function(){return eo},getArraySlice:function(){return es},getDeviceInfo:function(){return N},getNow:function(){return eL},getOsType:function(){return F},getPool:function(){return nk},getRandomString:function(){return eM},getType:function(){return B},getUserAgent:function(){return x},isAliApp:function(){return tE},isAliAppMiniApp:function(){return t1},isAliAppWeb:function(){return tc},isAliMiniApp:function(){return k},isAliMiniappPlatform:function(){return tI},isAliPay:function(){return tB},isAliPayWeb:function(){return to},isAliUa:function(){return tU},isAliWebInMiniApp:function(){return t0},isAlipayApp:function(){return tA},isAlipayMiniWeb:function(){return tV},isAlipayMiniapp:function(){return tj},isAndroid:function(){return L},isArray:function(){return ei},isArrayLike:function(){return er},isAsyncFunc:function(){return Z},isBaiduSmartProgram:function(){return tP},isBlob:function(){return q},isBlobUrlString:function(){return G},isByteDanceMicroApp:function(){return A},isCaiNiao:function(){return tH},isCaiNiaoApp:function(){return tk},isCaiNiaoBusiness:function(){return tR},isChrome:function(){return e1},isConstructor:function(){return en},isDataUrlString:function(){return K},isDingTalk:function(){return tX},isDingdingMiniapp:function(){return tw},isEdge:function(){return e8},isEmpty:function(){return U},isFalse:function(){return J},isFile:function(){return $},isFirefox:function(){return e2},isHmApp:function(){return t$},isHttpUrlString:function(){return V},isHttpsUrlString:function(){return z},isIOS:function(){return I},isIOSNotchScreen:function(){return t8},isIPhone14PM:function(){return t4},isIPhoneX:function(){return t2},isIPhoneXR:function(){return t6},isIPhoneXSMax:function(){return t3},isInIframe:function(){return Q},isKraken:function(){return e5},isKuaiShouMiniProgram:function(){return tS},isLBMiniWeb:function(){return tG},isLST:function(){return ta},isLT:function(){return tN},isLTMiniWeb:function(){return tz},isLTMiniapp:function(){return t_},isLTNode:function(){return tM},isLTWeb:function(){return te},isLXB:function(){return tu},isMMCMiniapp:function(){return tC},isMiniApp:function(){return T},isNaN:function(){return O},isNewEdge:function(){return e6},isNode:function(){return C},isNull:function(){return E},isNumber:function(){return R},isOldEdge:function(){return e4},isOpenHarmony:function(){return M},isPromise:function(){return H},isQuickApp:function(){return e9},isSafari:function(){return e3},isString:function(){return j},isTB:function(){return tF},isTBMiniWeb:function(){return tK},isTBMiniapp:function(){return tb},isTBNode:function(){return tL},isTBWeb:function(){return e7},isTaobaoMiniapp:function(){return tx},isTbLive:function(){return tn},isTbWebEnv:function(){return tr},isTmall:function(){return tD},isTrue:function(){return Y},isTuan:function(){return tl},isTuanWebview:function(){return tY},isUndef:function(){return b},isUrl:function(){return X},isWeChatMiniProgram:function(){return P},isWeb:function(){return _},isWebInDingding:function(){return ts},isWebInMiniApp:function(){return tQ},isWechat:function(){return tO},isWechatH5:function(){return tZ},isWechatMiniWeb:function(){return tJ},isWechatNode:function(){return tW},isWechatWeb:function(){return ti},isWeex:function(){return S},isXiNiaoapp:function(){return tT},isYouKu:function(){return tq},memoize:function(){return eH},merge:function(){return ea},omit:function(){return eO},onceFunc:function(){return e0},pick:function(){return eE},pipe:function(){return eq},reverseArgs:function(){return eJ},safeGetGlobal:function(){return eI},sleep:function(){return eX},sleepSync:function(){return eY},streamToArrayBuffer:function(){return eg},streamToBase64String:function(){return eC},streamToChunkBase64String:function(){return eT},streamToString:function(){return ep},stringToBinary:function(){return eb},stringToStream:function(){return ej},throttle:function(){return ez},tryCall:function(){return eQ},tryCallFunc:function(){return eZ},warning:function(){return D},withResolvers:function(){return eD}});var r,i,o,s,l,a=n(8296),u=n(6541),c=n(720),d=n(1729),h=n(6103),f=n(3438),p=n(8946),g=n.n(p);let v=Symbol&&Symbol("empty")||{},y=["url","map","set","weakmap","weakset"],m=(null===(r=Reflect)||void 0===r?void 0:r.apply)?e=>{let t=v;return function(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];return t===v&&(t=e()),"function"!=typeof t?t:Reflect.apply(t,null,r)}}:e=>{let t=v;return function(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];return t===v&&(t=e()),"function"!=typeof t?t:t(...r)}},w=function(e){let t=(null==e?void 0:e.clength)||(null==e?void 0:e.length)||0;if(!t)throw TypeError("无法读取函数参数列表的长度，不能使用可选参数和剩余参数！！！");let n=function(){for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];if(i.length>=t)return e(...i);{let e=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return n(...i.concat(t))};return e.clength=t-i.length,e}};return n.clength=t,n},x=m(()=>globalThis.navigator?globalThis.navigator.userAgent||globalThis.navigator.swuserAgent:process?`Node.js/${process.version} (${process.platform}; ${process.arch}) ${process.env.SHELL} ${process.env.LANG} ${process.env.TERM_PROGRAM}`:"");function j(e){return"string"==typeof e}function b(e){return"undefined"===e||typeof e>"u"}let _=m(()=>!x().toLocaleLowerCase().includes("node")&&window&&"onload"in window),C=m(()=>x().toLocaleLowerCase().includes("node")),T=m(()=>"u">typeof my&&null!==my&&"u">typeof my.alert),k=T,A=m(()=>"u">typeof tt&&null!==tt&&"u">typeof tt.showToast),P=m(()=>{var e,t;return!_()&&!A()&&!b(typeof wx)&&(!b(null===(e=wx)||void 0===e?void 0:e.login)||!b(null===(t=wx)||void 0===t?void 0:t.miniProgram))}),S=m(()=>"u">typeof WXEnvironment&&"Web"!==WXEnvironment.platform),I=m(()=>{let e=x().toLocaleLowerCase();return e.includes("iphone")||e.includes("ipad")}),L=m(()=>x().toLocaleLowerCase().includes("android")),M=m(()=>{let e=x();return/\sOpenHarmony\s\d/i.test(e)}),W=m(()=>{let e="",t="";if(_()||C()){let n=x();if(n){let r=n.match(/AliApp\(([\w-]+)\/([\d.]+)\)/i);r&&([,e,t]=r.map(e=>j(e)?e.toLowerCase():e))}}else if(k()){let{version:n="",app:r=""}=my.getSystemInfoSync()||{};e=r.toLowerCase(),t=n.toLowerCase()}return{appName:e,appVersion:t}}),F=m(()=>{if(I())return"ios";if(L())return"android";if(M())return"openHarmony";if(C()){let e=process.platform;return"darwin"===e?"mac":"win32"===e?"windows":"linux"===e?"linux":e}return"other"}),N=m(()=>{let e={platform:F(),userAgent:x()};if(_())return{...e,appName:navigator.appName,appVersion:navigator.appVersion,screenWidth:window.screen.width,screenHeight:window.screen.height,devicePixelRatio:window.devicePixelRatio};if(S())return{...e,appName:navigator.appName,appVersion:navigator.appVersion,screenWidth:window.screen.width/window.devicePixelRatio,screenHeight:window.screen.height/window.devicePixelRatio,devicePixelRatio:window.devicePixelRatio};if(T()){let t=my.getSystemInfoSync()||{};return{...e,appName:t.app,appVersion:t.version,platform:t.platform,screenWidth:t.screenWidth,screenHeight:t.screenHeight,devicePixelRatio:t.pixelRatio}}if(P()){var t,n;let r=(null===(n=wx)||void 0===n?void 0:null===(t=n.getSystemInfoSync)||void 0===t?void 0:t.call(n))||{};return{...e,appName:"wechat",appVersion:r.version,platform:r.platform,screenWidth:r.screenWidth,screenHeight:r.screenHeight,devicePixelRatio:r.pixelRatio}}if(A()){let t=tt.getSystemInfoSync()||{};return{...e,appName:"bytedance",appVersion:t.version,platform:t.platform,screenWidth:t.screenWidth,screenHeight:t.screenHeight,devicePixelRatio:t.pixelRatio}}return{...e,appName:"",appVersion:"",platform:"",screenWidth:0,screenHeight:0,devicePixelRatio:0}});function B(e){let t=typeof e;return"object"!==t&&"function"!==t?t:Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function D(){for(var e,t,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];(null===(t=globalThis)||void 0===t?void 0:null===(e=t.__ClConfig__)||void 0===e?void 0:e.disableWarning)||console.warn("@cmtlyt/base:>",...r)}function E(e){return typeof e>"u"||"object"==typeof e&&null===e}function O(e){return"number"==typeof e&&e!=e}function R(e){return"number"==typeof e}function H(e){return(e||!1)&&"function"==typeof e.then}function U(e){if(e===v)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return O(e)||!1;if("object"==typeof e&&null!==e){let t=B(e);return["set","map"].includes(t)||["weakmap","weakset"].includes(t)?0===e.size:0===Object.keys(e).length}return E(e)||!e}let $=m(()=>Q()?(D("iframe 中无法正确判断!!!"),!1):!!File&&(File.prototype?e=>Object.prototype.isPrototypeOf.call(File.prototype,e):e=>e instanceof File)),q=m(()=>Q()?(D("iframe 中无法正确判断!!!"),!1):!!Blob&&(Blob.prototype?e=>Object.prototype.isPrototypeOf.call(Blob.prototype,e):e=>e instanceof Blob));function V(e){return"string"==typeof e&&(/^http?:\/\//.test(e)||/^\/\//.test(e))}function z(e){return"string"==typeof e&&/^https:\/\//.test(e)||/^\/\//.test(e)}function G(e){return"string"==typeof e&&e.startsWith("blob:")}function K(e){return"string"==typeof e&&e.startsWith("data:")}function X(e){return Q()?(D("iframe 中无法正确判断!!!"),!1):e instanceof URL||V(e)||z(e)||G(e)||K(e)}function Y(e){return!0===e||"true"===String(e).toLowerCase()}function J(e){return!1===e||"false"===String(e).toLowerCase()}function Z(e){return D("该方法存在生产环境和开发环境结果不一致风险, 请谨慎使用, 例如使用 babel 转换后 async 函数会变成普通函数"),"asyncfunction"===B(e)}function Q(){var e,t,n,r,i;return!!_()&&(null===(t=window)||void 0===t?void 0:null===(e=t.frames)||void 0===e?void 0:e.length)!==(null===(i=window)||void 0===i?void 0:null===(r=i.parent)||void 0===r?void 0:null===(n=r.frames)||void 0===n?void 0:n.length)}function ee(e){var t,n,r;return _()?!(typeof window>"u")&&((null===(r=window)||void 0===r?void 0:null===(n=r.CSS)||void 0===n?void 0:null===(t=n.supports)||void 0===t?void 0:t.call(n,e))||!1):(D("caniuse 只能在浏览器环境中使用"),!1)}function et(e){return _()?!(typeof window>"u")&&"u">typeof window[e]:(D("caniuse 只能在浏览器环境中使用"),!1)}function en(e){return e instanceof Object&&"function"==typeof Object.getPrototypeOf(e).constructor}function er(e){return!!(Array.isArray(e)||e instanceof String||e&&"object"==typeof e&&"number"==typeof e.length)}function ei(e){return Array.isArray(e)}function eo(e){return E(e)?[]:Array.isArray(e)?e:[e]}function es(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t<=0?[e]:e.slice(n).reduce((e,n,r)=>(r%t==0&&e.push([]),e[e.length-1].push(n),e),[])}function el(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new WeakMap;if(null===e||"object"!=typeof e||y.includes(B(e)))return e;if(t.has(e))return t.get(e);let n=Array.isArray(e)?[]:{};for(let r in t.set(e,n),e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=el(e[r],t));return n}function ea(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((e,t)=>(function e(t,n){let r=B(t);if(y.includes(r))return t;if(r!==B(n))return y.includes(B(n))?n:(D("传入的两个参数类型不同,无法合并"),t);if("string"===r||"number"===r)return t+n;if(Array.isArray(t))return t.concat(n);if("object"===r)for(let r in n){let i=n[r],o=t[r]??i;y.includes(B(o))||"object"!=typeof i||null===i||(o=e(o=t[r]||(Array.isArray(i)?[]:{}),i)),t[r]=o}return t||n})(e,t),e)}function eu(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return ea(e=el(e),...n)}function ec(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1?arguments[1]:void 0;return D("未来会实现~"),t?e.toLocaleString():`${e.valueOf()}`}function ed(e,t,n){return new Promise((r,i)=>{t=new RegExp(t);let o=e.match(t);if(!o){r(e);return}(async()=>{try{let s=await n(...Array.from(o)).catch(i);r(e.replace(t,s))}catch(e){i(e)}})()})}async function eh(e,t,n){if("string"==typeof n)return e.replace(t,n);if("function"!=typeof n)throw TypeError("replacer 必须是字符串或函数");return"string"==typeof t?ed(e,t,n):t instanceof RegExp?t.global?new Promise((r,i)=>{let o,s=0,l=[];for(o=t.exec(e);null!==o;){let r=n(...Array.from(o)),i=e.slice(s,o.index);s=o.index+o[0].length,l.push(i,r),o=t.exec(e)}let a=e.slice(s);l.push(a),(async()=>{let e=await Promise.all(l).catch(i);e&&r(e.join(""))})()}):ed(e,t,n):e}async function ef(e,t){if(!Array.isArray(e))throw TypeError("arr 必须是数组");return t&&"function"==typeof t?(await Promise.all(e.map(async(e,n)=>await t(e,n)?e:null))).filter(Boolean):e}async function ep(e){let t=e.getReader(),n=[],r="";for(;;){let{done:e,value:r}=await t.read();if(e)break;n.push(r)}let i=new TextDecoder("utf-8");for(let e of n)r+=i.decode(e);return r+i.decode()}async function eg(e){let t=e.getReader(),n=[],r=0;for(;;){let{done:e,value:i}=await t.read();if(e)break;n.push(i),r+=i.byteLength}let i=new ArrayBuffer(r),o=0;for(let e of n){let t=new Uint8Array(e);new Uint8Array(i,o,t.length).set(t),o+=t.length}return i}function ev(e){return e.byteLength>=65556&&D("buffer size too large, use arrayBufferToChunkBase64String"),btoa(String.fromCharCode(...new Uint8Array(e)))}function ey(e){e.length>=65556&&D("base64 size too large, use chunkBase64StringToArrayBuffer");let t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return r}function em(e){let t=[],n=e.slice(10240*t.length,10240*t.length+10240);for(;n.byteLength>0;)t.push(ev(n)),n=e.slice(10240*t.length,10240*t.length+10240);return t.join("|")}function ew(e){return new Blob(e.split("|").map(e=>ey(e)))}async function ex(e){return ew(e).arrayBuffer()}function ej(e){let t=new TextEncoder;return new ReadableStream({start(n){n.enqueue(t.encode(e)),n.close()}})}function eb(e){return new TextEncoder().encode(e)}function e_(e){return new TextDecoder().decode(e)}async function eC(e){return ev(await eg(e))}async function eT(e){return em(await eg(e))}async function ek(e){return ew(e).stream()}function eA(e){return new ReadableStream({start(t){t.enqueue(e),t.close()}})}function eP(e){return eA(ey(e))}async function eS(e){return em(await e.arrayBuffer())}let eI=m(()=>_()?window:globalThis||(S()?weex:T()?my:P()?wx:A()?tt:{})),eL=m(()=>"u">typeof performance?()=>performance.now():()=>Date.now());function eM(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=Math.random().toString(36).slice(2,e+2);return t.length===e?t:t+eM(e-t.length)}function eW(e){let t=new Blob([e]);return URL.createObjectURL(t)}function eF(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{duration:t,expires:n,domain:r,maxAge:i,path:o}=e,s="";if(U(e))return s;if(t){let e=new Date;e.setTime(e.getTime()+t),s+=`expires=${e.toUTCString()};`}else if(n){if("string"==typeof n){let e=new Date;e.setTime(e.getTime()+g()(n)),s+=`expires=${e.toUTCString()};`}else if(n instanceof Date)s+=`expires=${n.toUTCString()};`;else throw TypeError("expires 必须是字符串或 Date (推荐使用Date)")}return r&&(s+=`domain=${r};`),i&&(s+=`max-age=${i};`),o&&(s+=`path=${o};`),s}function eN(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.length?t.map(e=>"string"==typeof e?e:Array.isArray(e)?eN(...e):"object"==typeof e&&null!==e?Object.keys(e).filter(t=>e[t]).join(" "):"").join(" ").replace(/\s+/g," ").trimEnd():""}let eB=eN;function eD(e){let t=()=>{},n=()=>{},r=new Promise((r,i)=>{t=r,n=i,null==e||e(r,i)});return{resolve:t,reject:n,promise:r}}let eE=w((e,t)=>{let n={};return eo(e).forEach(e=>n[e]=t[e]),n}),eO=w((e,t)=>{let n={},r=eo(e);return Object.keys(t).forEach(e=>{r.includes(e)||(n[e]=t[e])}),n}),eR=(i=new WeakMap,o=new WeakMap,s=new WeakSet,l=class{set(e,t){(0,d._)(this,s,rd).call(this,e)?(0,a._)(this,o).set(e,t):(0,a._)(this,i).set(e,t)}get(e){return(0,d._)(this,s,rd).call(this,e)?(0,a._)(this,o).get(e):(0,a._)(this,i).get(e)}has(e){return(0,d._)(this,s,rd).call(this,e)?(0,a._)(this,o).has(e):(0,a._)(this,i).has(e)}constructor(){(0,h._)(this,s),(0,u._)(this,i,{writable:!0,value:new Map}),(0,u._)(this,o,{writable:!0,value:new WeakMap})}});function eH(e,t){let n=function(){for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];let s=t?t(...i):i[0],l=n.cache;if(l.has(s))return l.get(s);let a=e(...i);return l.set(s,a),a};return n.cache=new eR,n}function eU(e,t){return 0===e.length?e=>e:1===e.length?e[0]:function(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];return t(e,r)}}let e$=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=eU(t,(e,t)=>e.reduceRight((e,t)=>t(...eo(e)),t)),i=t[t.length-1];return r.clength=(null==i?void 0:i.clength)||(null==i?void 0:i.length),r},eq=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=eU(t,(e,t)=>e.reduce((e,t)=>t(...eo(e)),t)),i=t[0];return r.clength=(null==i?void 0:i.clength)||(null==i?void 0:i.length),r};function eV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t<=0)return e;let r=null;return m(()=>n?function(){for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];r?clearTimeout(r):e(...i),r=setTimeout(()=>{r=null},t)}:function(){for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];r&&clearTimeout(r),r=setTimeout(()=>{e(...i)},t)})}function ez(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(t<=0)return e;let r=null;return m(()=>n?function(){for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];r||(e(...i),r=setTimeout(()=>{r=null},t))}:function(){for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];r||(r=setTimeout(()=>{e(...i),r=null},t))})}let eG=m(()=>globalThis.requestIdleCallback?(e,t,n,r)=>{requestIdleCallback(i=>{if(i.timeRemaining()>0)try{let r=e(...t);n(r)}catch(e){r(e)}else eG(e,t,n,r)})}:globalThis.requestAnimationFrame?(e,t,n,r)=>{let i=eL();requestAnimationFrame(()=>{if(eL()-i<16.6)try{let r=e(...t);n(r)}catch(e){r(e)}else eG(e,t,n,r)})}:(e,t,n,r)=>{setTimeout(()=>{try{let r=e(...t);n(r)}catch(e){r(e)}},0)});function eK(e){return t=>{let n=[];return new Promise((r,i)=>{let o=async t=>new Promise(eG.bind(null,e,t)).then(e=>n.push(e),i);(async()=>{if("number"==typeof t)for(let e=0;e<t;++e)await o([e]);else if(Array.isArray(t))for(let e in t){let n=t[e];await o(n)}r(n)})()})}}let eX=e=>new Promise(t=>setTimeout(t,e));function eY(e){let t=eL();for(;eL()-t<e;);}function eJ(e){return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return e(...n.reverse())}}function eZ(e,t){return function(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];try{return e(...r)}catch(e){throw t&&t(e),e}}}function eQ(e,t){try{return e()}catch(e){throw t&&t(e),e}}function e0(e){let t=!1,n=null;return function(){for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];return t?n:(t=!0,n=e(...i))}}let e1=m(()=>{let e=x().toLocaleLowerCase();return e.includes("chrome")||e.includes("crios")||e.includes("headlesschrome")}),e2=m(()=>x().toLocaleLowerCase().includes("firefox")),e3=m(()=>x().toLocaleLowerCase().includes("safari")&&!e1()),e6=m(()=>x().toLocaleLowerCase().includes("edg")),e4=m(()=>{let e=x().toLocaleLowerCase();return e.includes("edge")&&!e.includes("edg")}),e8=m(()=>x().toLocaleLowerCase().includes("edge")),e5=m(()=>"u">typeof __kraken__),e9=m(()=>"u">typeof n.g&&null!==n.g&&"u">typeof n.g.callNative&&!S()),e7=m(()=>{let e=x();return _()&&/AliApp\(TB/i.test(e)}),te=m(()=>{let e=x();return _()&&/AliApp\(LT/i.test(e)}),tn=m(()=>{let e=x();return(_()||C())&&/AliApp\(TAOBAOLIVEAPP/i.test(e)}),tr=m(()=>e7()||_()&&tn()),ti=m(()=>{let e=x();return _()&&/MicroMessenger/i.test(e)}),to=m(()=>{let e=x();return _()&&/AliApp\(AP/i.test(e)}),ts=m(()=>{let e=x();return _()&&/AliApp\(DingTalk/i.test(e)}),tl=m(()=>{let e=x();return _()&&/AliApp\(MMC/i.test(e)}),ta=m(()=>{let e=x();return _()&&/AliApp\(RetailTrader/i.test(e)}),tu=m(()=>{let e=x();return _()&&/AliApp\(RETAIL(?!Trader)/i.test(e)}),tc=m(()=>e7()||te()||tn()||to()),td=["taobao","tb"],th=["lt"],tf=["mmc","hmjs-c"],tp=["xiniao"],tg=[...td,...th,...tf,...tp,"cngl"],tv=["alipay"],ty=["cn","cainiao","com.cainiao.wireless"],tm=[...tv,...ty],tw=m(()=>!b(typeof dd)&&null!==dd&&!b(typeof dd.alert)&&!_()),tx=m(()=>{let{appName:e}=W();return k()&&tg.includes(e)}),tj=m(()=>{let{appName:e}=W();return k()&&tm.includes(e)}),tb=m(()=>{let{appName:e}=W();return k()&&td.includes(e)}),t_=m(()=>{let{appName:e}=W();return k()&&th.includes(e)}),tC=m(()=>{let{appName:e}=W();return k()&&tf.includes(e)}),tT=m(()=>{let{appName:e}=W();return k()&&tp.includes(e)}),tk=m(()=>{let{appName:e}=W();return k()&&ty.includes(e)}),tA=m(()=>{let{appName:e}=W();return k()&&tv.includes(e)}),tP=m(()=>"u">typeof swan&&null!==swan&&"u">typeof swan.showToast),tS=m(()=>"u">typeof ks&&null!==ks&&"u">typeof ks.showToast),tI=m(()=>k()||P()||A()),tL=m(()=>{let e=x().toLocaleLowerCase();return C()&&/AliApp\(TB/i.test(e)}),tM=m(()=>{let e=x().toLocaleLowerCase();return C()&&/AliApp\(LT/i.test(e)}),tW=m(()=>{let e=x().toLocaleLowerCase();return C()&&/MicroMessenger/i.test(e)}),tF=m(()=>tb()||e7()||tL()),tN=m(()=>t_()||te()||tM()),tB=m(()=>tj()||to()),tD=m(()=>{let{appName:e}=W();return"tm"===e}),tE=m(()=>tF()||tN()||tB()||tn()||tD()),tO=m(()=>ti()||P()||tW()),tR=m(()=>{let e=x();return _()&&/AliApp\(group_leader/i.test(e)}),tH=m(()=>{let e=x();return _()&&(/AliApp\(CN/i.test(e)||/AliApp\(cainiao/i.test(e))}),tU=m(()=>_()&&/AliApp\(/.test(window.navigator.userAgent)),t$=m(()=>{let{appName:e}=W();return"wdkhema"===e}),tq=m(()=>{let{appName:e}=W();return"youku"===e}),tV=m(()=>{var e,t,n,r;return!!(_()&&(null===(r=window)||void 0===r?void 0:null===(n=r.location)||void 0===n?void 0:null===(t=n.search)||void 0===t?void 0:null===(e=t.includes)||void 0===e?void 0:e.call(t,"__webview__=alipay")))}),tz=m(()=>{var e,t,n,r;return!!(te()&&(null===(r=window)||void 0===r?void 0:null===(n=r.location)||void 0===n?void 0:null===(t=n.search)||void 0===t?void 0:null===(e=t.includes)||void 0===e?void 0:e.call(t,"__webview__=taobao")))}),tG=m(()=>{var e,t,n,r;return!!(e7()&&(null===(r=window)||void 0===r?void 0:null===(n=r.location)||void 0===n?void 0:null===(t=n.search)||void 0===t?void 0:null===(e=t.includes)||void 0===e?void 0:e.call(t,"__webview__=taobao")))}),tK=m(()=>tG()),tX=m(()=>{let e=x();return _()&&/AliApp\(DingTalk/i.test(e)}),tY=m(()=>{var e,t,n,r;return _()&&(tl()||tR()||(null===(r=window)||void 0===r?void 0:null===(n=r.location)||void 0===n?void 0:null===(t=n.search)||void 0===t?void 0:null===(e=t.includes)||void 0===e?void 0:e.call(t,"__webview__=mmc")))}),tJ=m(()=>{let e=x();return ti()&&/miniProgram/i.test(e)}),tZ=m(()=>ti()&&!tJ()),tQ=m(()=>tV()||tJ()||tG()||tz()),t0=m(()=>tV()||tG()||tz()),t1=m(()=>tb()||t_()||tj()||tC()),t2=m(()=>{let{screenHeight:e}=N();return I()&&[812,896,844,926,693,780,932,852].includes(P()?(wx.getSystemInfoSync()||{}).screenHeight:e)}),t3=m(()=>{let{screenHeight:e,devicePixelRatio:t}=N();return I()&&896===e&&3===t}),t6=m(()=>{let{screenHeight:e,devicePixelRatio:t}=N();return I()&&896===e&&2===t}),t4=m(()=>{let{screenHeight:e}=N();return I()&&932===e}),t8=m(()=>t2()||t3()||t6()||t4());var t5=new WeakMap,t9=new WeakMap,t7=new WeakSet;class ne{static group(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if("function"!=typeof e)throw TypeError("func 必须是一个函数");let n=new ne(t);return e(n)??n}add(e){return e=(0,d._)(this,t7,nt).call(this,e),(0,c._)(this,t9,(0,a._)(this,t9)+(0,a._)(this,t5)),(0,c._)(this,t5,e),this}sub(e){return e=(0,d._)(this,t7,nt).call(this,e),(0,c._)(this,t9,(0,a._)(this,t9)+(0,a._)(this,t5)),(0,c._)(this,t5,-e),this}mut(e){return e=(0,d._)(this,t7,nt).call(this,e),(0,c._)(this,t5,(0,a._)(this,t5)*e),this}div(e){return e=(0,d._)(this,t7,nt).call(this,e),(0,c._)(this,t5,(0,a._)(this,t5)/e),this}getCurrValue(){return(0,a._)(this,t9)+(0,a._)(this,t5)}valueOf(){return(0,c._)(this,t5,this.getCurrValue()),(0,c._)(this,t9,0),(0,a._)(this,t5)}constructor(e=0){(0,h._)(this,t7),(0,u._)(this,t5,{writable:!0,value:void 0}),(0,u._)(this,t9,{writable:!0,value:void 0}),(0,c._)(this,t5,e),(0,c._)(this,t9,0)}}function nt(e){if(e instanceof ne)return e.getCurrValue();if(R(e))return e;throw TypeError("value 必须是一个数字或 Calculator")}let nn=m(()=>{var e;return"function"==typeof(null===(e=eI().document)||void 0===e?void 0:e.execCommand)}),nr=m(()=>{var e,t;return(null===(t=eI().document)||void 0===t?void 0:null===(e=t.queryCommandSupported)||void 0===e?void 0:e.call(t,"copy"))&&nn()}),ni=m(()=>{var e,t;return(null===(t=eI().document)||void 0===t?void 0:null===(e=t.queryCommandSupported)||void 0===e?void 0:e.call(t,"paste"))&&nn()}),no=m(()=>{var e,t;return z(null===(e=eI().location)||void 0===e?void 0:e.href)&&!!(null===(t=navigator.clipboard)||void 0===t?void 0:t.writeText)||!1}),ns=m(()=>no()||nr()||!1),nl=m(()=>{var e,t;return z(null===(e=eI().location)||void 0===e?void 0:e.href)&&!!(null===(t=navigator.clipboard)||void 0===t?void 0:t.readText)||!1}),na=m(()=>nl()||ni()||!1),nu=m(()=>{if(no())return e=>{navigator.clipboard.writeText(e)};if(nr()){let e=eI().document;return t=>{let n=e.createElement("input");n.setAttribute("value",t),e.body.appendChild(n),n.select(),e.execCommand("copy"),e.body.removeChild(n)}}return e=>{D("copy not supported:> ",e)}}),nc=m(()=>{if(nl())return()=>navigator.clipboard.readText();if(ni()){let e=eI().document;return()=>{let t=e.createElement("input");e.body.appendChild(t),t.select();try{e.execCommand("paste")}catch{return Promise.reject(Error("paste not supported"))}let n=t.value;return e.body.removeChild(t),Promise.resolve(n)}}return()=>(D("paste not supported"),Promise.reject(Error("paste not supported")))}),nd={copy:nu,paste:nc,clear:m(()=>{if(no())return()=>{navigator.clipboard.writeText("")};if(nr()){let e=eI().document;return()=>{let t=e.createElement("input");e.body.appendChild(t),t.select(),e.execCommand("copy"),e.body.removeChild(t)}}return()=>{D("clear not supported")}}),get isCopyable(){return ns()},get isPasteable(){return na()},get isClearable(){return ns()}},nh={get(e){var t,n;return(null===(n=eI().document)||void 0===n?void 0:null===(t=n.cookie.split("; ").find(t=>t.startsWith(`${e}=`)))||void 0===t?void 0:t.split("=")[1])||""},set(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=eI().document;(null==r?void 0:r.cookie)&&(r.cookie=`${e}=${t};${eF(n)}`)},remove(e){let t=eI().document;(null==t?void 0:t.cookie)&&(t.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 GMT`)}},nf={};var np=new WeakMap,ng=new WeakMap,nv=new WeakMap,ny=new WeakMap,nm=new WeakSet,nw=new WeakSet,nx=new WeakSet;class nj{static getPool(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2?arguments[2]:void 0,r=n||(()=>v);return e?nf[e]??(nf[e]=new nj(t,r,e)):new nj(t,r,e)}put(e){if((0,d._)(this,nw,n_).call(this,e),(0,a._)(this,nv).length){let{resolve:e}=(0,a._)(this,nv).shift();this.get().then(t=>{e(t)})}}async get(){let e=(0,a._)(this,ng).findIndex(e=>e.data!==v);return(0,d._)(this,nx,nC).call(this,e)}close(e){(0,a._)(this,ng).forEach(t=>{let{data:n}=t;return e(n)}),(0,c._)(this,ng,[]),(0,c._)(this,nv,[]),this.usableCount=0,this.isClose=!0,(0,c._)(this,ny,e),delete nf[a._(this,np)]}constructor(e=5,t=()=>v,n=Symbol("")){(0,h._)(this,nm),(0,h._)(this,nw),(0,h._)(this,nx),(0,u._)(this,np,{writable:!0,value:void 0}),(0,u._)(this,ng,{writable:!0,value:void 0}),(0,u._)(this,nv,{writable:!0,value:void 0}),(0,u._)(this,ny,{writable:!0,value:void 0}),(0,f._)(this,"usableCount",void 0),(0,f._)(this,"isClose",void 0),(0,c._)(this,np,n),(0,c._)(this,ng,Array.from({length:e},(e,n)=>(0,d._)(this,nm,nb).call(this,t(n)))),(0,c._)(this,nv,[]),this.usableCount=(0,a._)(this,ng).reduce((e,t)=>(t.data!==v&&e++,e),0),this.isClose=!1,(0,c._)(this,ny,()=>{})}}function nb(e){return{data:e,__id:eM(32)}}function n_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.isClose)throw(0,a._)(this,ny).call(this,e),Error("池子已关闭");if("number"==typeof t){let n=(0,a._)(this,ng)[t];n.data=e,n.__id=eM(32)}else{let t=(0,a._)(this,ng).findIndex(e=>e.data===v);if(!~t)throw Error("池子已满");(0,a._)(this,ng)[t]=(0,d._)(this,nm,nb).call(this,e)}++this.usableCount}async function nC(e){if(this.isClose)throw Error("池子已关闭");let t=(0,a._)(this,ng)[e];if(!t||t.data===v)return new Promise((e,t)=>{(0,a._)(this,nv).push({resolve:e,reject:t})});let{data:n,__id:r}=t,i=()=>{if(this.isClose)throw(0,d._)(this,nw,n_).call(this,n,e),Error("池子已关闭");if(r!==t.__id)throw Error("数据已被返还")},o=()=>{(0,d._)(this,nw,n_).call(this,n,e)};--this.usableCount;let s=function(){if(this===u)return i(),n},l=function(){if(this===u)return i(),o()},u={data(){return s.call(this)},unUse(){return l.call(this)}};return Promise.resolve(u)}function nT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2?arguments[2]:void 0;return nj.getPool(n,t,e)}function nk(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return nj.getPool(e)}function nA(e){return new Worker(e)}function nP(){let e=[],t=t=>{e.push(t)},n=t=>{e.splice(e.indexOf(t),1)};return{on:t,remove:n,clearOn:()=>{e.length=0},onOnce:e=>{let r=function(){for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];e(...i),n(r)};t(r)},emit:t=>{for(let n of e)n(t)}}}function nS(e){let{emit:t,type:n,result:r,error:i,resolve:o=()=>{},reject:s=()=>{},isSysCall:l,eventData:a}=e;if(l)"success"===n?o(r):s(i);else{let{__clUserCall:e,data:n}=a;t(e?n:a)}}function nI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!et("Worker"))return D("不支持 web worker 已降级"),{run:async function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return await e(...n)},dispose:()=>{},...nP()};let{reuse:r=!0,needPost:i=!1}=n||{},o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return`
${t.length?`importScripts("${t.join('", "')}");`:""}
const func = ${e};

const { postMessage } = (()=>{
  const postMessage = (data) => {
    self.postMessage({ __clUserCall: true, data })
  };
  return { postMessage: (data) => postMessage(data) };
})();

self.onmessage = async (e) => {
  const { callId, data: args } = e.data
  try {
    const result = await func.apply(null, ${n?"[postMessage, ...args]":"args"});
    self.postMessage({ __clSysCall: true, type: 'success', result, callId });
  } catch (e) {
    self.postMessage({ __clSysCall: true, callId, type: 'error', error: e })
  }
}
self.onerror = (e) => {
  self.postMessage({ __clSysCall: true, type: 'error', error: e })
}`}(e,function(e){let t=[],n=[];return e.forEach(e=>{"string"==typeof e?n.push(e):"function"==typeof e&&t.push(e)}),n.push(eW(t.map(e=>`function ${e.name}(...args) { return (${e})(...args); }`).join(`
`))),n}(t),i),s=eW(o);return r?function(e){let t=nA(e),n=!1,r={},{emit:i,...o}=nP();return t.onmessage=e=>{let{type:t,result:n,error:o,callId:s,__clSysCall:l}=e.data,{resolve:a,reject:u}=r[s]||{};l&&delete r[s],nS({emit:i,type:t,result:n,error:o,resolve:a,reject:u,isSysCall:l,eventData:e.data})},{run:async function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];if(n)throw Error("worker资源已释放");let s=eM(16);return new Promise((e,n)=>{r[s]={resolve:e,reject:n},t.postMessage({callId:s,data:i})})},dispose:()=>{t.terminate(),r=null,n=!0,URL.revokeObjectURL(e)},...o}}(s):function(e){let t=!1,{emit:n,...r}=nP();return{run:async function(){for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];if(t)throw Error("worker资源已释放");let s=nA(e);return new Promise((e,t)=>{s.onmessage=r=>{let{type:i,result:o,error:l,__clSysCall:a}=r.data;a&&s.terminate(),nS({emit:n,type:i,result:o,error:l,resolve:e,reject:t,isSysCall:a,eventData:r.data})},s.postMessage({data:i})})},dispose:()=>{t=!0,URL.revokeObjectURL(e)},...r}}(s)}let nL=["FormData","binary"],nM=["json","string"],nW=["POST","PUT"],nF=["chunk","file"];function nN(e,t,n,r,i){return(Array.isArray(t)?t.includes(B(n)):B(n)===t)&&(!i||i.includes(n))?n:(D(`options.${e} \u5FC5\u987B\u662F${t}\uFF0C\u5DF2\u4F7F\u7528\u9ED8\u8BA4\u503C ${r} \u4EE3\u66FF`),r)}let nB=async e=>{let{uploadInfo:t,fileUrl:n,chunkIdxInfo:r,chunkSize:i,serverPath:o,dataKey:s,responseType:l,requestMethod:a,headers:u,chunkIdxs:c,retryCount:d,dataType:h,requestOptions:f}=e,p=[],g=await fetch(n).then(e=>e.blob()),[v,y]=r,m=c.length>0?c:Array.from({length:y-v},(e,t)=>v+t),w=e=>{if(i<=0)return g.slice();let t=e*i,n=Math.min(g.size,t+i);return g.slice(t,n)},x=async e=>"json"===l?await e.json():"string"===l?await e.text():"none",j=async(e,t)=>{let n={chunkIdx:e,status:"loading",response:await x(t)};200===t.status?n.status="success":(n.status="fail",p.push(e)),self.postMessage(n)},b=(e,n)=>{p.push(e),self.postMessage({chunkIdx:e,status:"error",message:n,uploadInfo:t})},_=userHeadersHandler||(()=>{}),C=userBodyHandler||(()=>{}),T=async e=>{let n=w(e),r=new FormData;r.append(s,n),r.append("chunkIdx",`${e}`);let i=await C({chunk:n,chunkIdx:e,customOption:t.customOption});return"object"==typeof i&&Object.keys(i).forEach(e=>{r.append(e,i[e])}),r},k=async e=>w(e),A=async e=>"FormData"===h?T(e):"binary"===h?k(e):void 0,P=async e=>{let n=await _({chunkIdx:e,currentHeanders:u,customOption:t.customOption});return{...u,...n}},S=async e=>{for(let t of e){let e=await A(t),n=await P(t);console.log("run",n),await fetch(o,{...f,method:a,body:e,headers:n}).then(j.bind(null,t)).catch(b.bind(null,t))}};await S(m);for(let e=0;e<d&&0!==p.length;++e){let e=[...p];p.length=0,await S(e)}return{status:"finished",message:"上传结束",chunks:m,errorChunks:p}},nD={waiting:"waiting",uploading:"uploading",closed:"closed"};async function nE(e){return $(e)||q(e)?Promise.resolve(e):X(e)?await fetch(e).then(e=>e.blob()):void 0}function nO(e){return e?e.includes("=>")||e.startsWith("function")||e.startsWith("async function")?e:e.startsWith("async")?e.replace("async","async function "):`function ${e}`:""}let nR={};var nH=new WeakMap,nU=new WeakMap,n$=new WeakMap,nq=new WeakMap,nV=new WeakMap,nz=new WeakMap,nG=new WeakMap,nK=new WeakMap,nX=new WeakMap,nY=new WeakMap,nJ=new WeakMap,nZ=new WeakMap,nQ=new WeakMap,n0=new WeakMap,n1=new WeakSet,n2=new WeakSet,n3=new WeakSet,n6=new WeakSet,n4=new WeakSet,n8=new WeakSet,n5=new WeakSet,n9=new WeakSet,n7=new WeakSet;class re{static getInstance(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{url:n}=e;return t?nR[n]=new re(e):nR[n]??(nR[n]=new re(e))}retry(e,t,n){return(0,d._)(this,n7,ru).call(this,e,{...n,chunkIdxs:t})}upload(e,t){if((0,a._)(this,nZ)!==nD.closed)return(0,d._)(this,n7,ru).call(this,e,{...t||{},chunkIdxs:[]})}abort(e){var t;return!!(null===(t=(0,a._)(this,nJ).splice((0,a._)(this,nJ).findIndex(t=>t.file===e),1))||void 0===t?void 0:t.length)}clear(){(0,c._)(this,nJ,[])}close(){(0,c._)(this,nZ,nD.closed),(0,a._)(this,n0).close(e=>e.dispose())}constructor(e){(0,h._)(this,n1),(0,h._)(this,n2),(0,h._)(this,n3),(0,h._)(this,n6),(0,h._)(this,n4),(0,h._)(this,n8),(0,h._)(this,n5),(0,h._)(this,n9),(0,h._)(this,n7),(0,u._)(this,nH,{writable:!0,value:void 0}),(0,u._)(this,nU,{writable:!0,value:void 0}),(0,u._)(this,n$,{writable:!0,value:void 0}),(0,u._)(this,nq,{writable:!0,value:void 0}),(0,u._)(this,nV,{writable:!0,value:void 0}),(0,u._)(this,nz,{writable:!0,value:void 0}),(0,u._)(this,nG,{writable:!0,value:void 0}),(0,u._)(this,nK,{writable:!0,value:void 0}),(0,u._)(this,nX,{writable:!0,value:void 0}),(0,u._)(this,nY,{writable:!0,value:void 0}),(0,u._)(this,nJ,{writable:!0,value:void 0}),(0,u._)(this,nZ,{writable:!0,value:void 0}),(0,u._)(this,nQ,{writable:!0,value:void 0}),(0,u._)(this,n0,{writable:!0,value:void 0});(0,c._)(this,nH,e.url),(0,c._)(this,nU,e.maxConcurrent),(0,c._)(this,n$,e.concurrentNode),(0,c._)(this,nq,e.chunkSize),(0,c._)(this,nV,e.dataType),(0,c._)(this,nz,e.dataKey),(0,c._)(this,nG,e.responseType),(0,c._)(this,nK,e.retryCount),(0,c._)(this,nX,e.requestMethod);let{bodyHandler:t,headersHandler:n}=e;(0,c._)(this,nY,e),(0,c._)(this,nJ,[]),(0,c._)(this,nZ,nD.waiting),(0,c._)(this,nQ,{});let r=function(e){let{bodyHandler:t,headersHandler:n}=e,r=nO(null==t?void 0:t.toString()),i=nO(null==n?void 0:n.toString());return eW(`
    ${t?`const userBodyHandler = ${r};`:""}
    ${n?`const userHeadersHandler = ${i};`:""}
  `)}({bodyHandler:t,headersHandler:n});(0,c._)(this,n0,nT(()=>nI(nB,[r],{reuse:!1}),(0,a._)(this,nU),Symbol("uploader")))}}function rt(e,t){e(t)}function rn(e){return e.some(e=>{var t,n;return null===(n=e.data)||void 0===n?void 0:null===(t=n.errorChunks)||void 0===t?void 0:t.length})?"error":"success"}function rr(e){return e.reduce((e,t)=>{var n;return e.concat((null===(n=t.data)||void 0===n?void 0:n.errorChunks)||[])},[])}async function ri(e,t,n){let{id:r,workerTotal:i}=t,o=(0,a._)(this,nQ)[r];o.push({data:n}),o.length>=i&&(e({taskInfo:o,taskStatus:(0,d._)(this,n2,rn).call(this,o),errorChunks:(0,d._)(this,n3,rr).call(this,o),customOption:t.customOption}),delete a._(this,nQ)[r],Object.keys((0,a._)(this,nQ))||(0,c._)(this,nZ,nD.waiting))}async function ro(e){let{uploadInfo:t,fileUrl:n,start:r,end:i,onProgress:o,worker:s,resolve:l,reject:u,chunkIdxs:c=[]}=e,h={uploadInfo:t,chunkIdxs:c,fileUrl:n,chunkIdxInfo:[r,i],chunkSize:(0,a._)(this,nq),serverPath:(0,a._)(this,nH),dataKey:(0,a._)(this,nz),responseType:(0,a._)(this,nG),requestMethod:(0,a._)(this,nX),headers:(0,a._)(this,nY).headers,retryCount:(0,a._)(this,nK),dataType:(0,a._)(this,nV)},f=(0,d._)(this,n1,rt).bind(this,o);return s.on(f),s.run(h).then((0,d._)(this,n6,ri).bind(this,l,t),u).finally(()=>{s.remove(f),(0,d._)(this,n9,ra).call(this)})}async function rs(e){let{runWorkerBaseData:t,retryChunksMap:n,taskChunkSize:r,chunkTotal:i}=e;if(n.length){for(let e in n){let r=await (0,a._)(this,n0).get();(0,d._)(this,n4,ro).call(this,{chunkIdxs:n[e],start:0,end:0,worker:r.data(),...t})}return}if("chunk"===(0,a._)(this,n$)){for(let e=0;e<(0,a._)(this,nU);++e){let n=await (0,a._)(this,n0).get(),o=e*r,s=Math.min(i,o+r);(0,d._)(this,n4,ro).call(this,{start:o,end:s,worker:n.data(),...t})}return}if("file"===(0,a._)(this,n$)){t.workerTotal=1;let e=await (0,a._)(this,n0).get();(0,d._)(this,n4,ro).call(this,{start:0,end:i,worker:e.data(),...t})}}function rl(e){return e.length?e.length:"chunk"===(0,a._)(this,n$)?(0,a._)(this,nU):"file"===(0,a._)(this,n$)?1:0}async function ra(){if((0,a._)(this,nZ)===nD.closed||0===(0,a._)(this,nJ).length||0===(0,a._)(this,n0).usableCount)return;(0,c._)(this,nZ,nD.uploading);let{file:e,resolve:t,reject:n,chunkIdxs:r=[],onProgress:i=()=>{},customOption:o={}}=(0,a._)(this,nJ).shift(),s=await nE(e),l=URL.createObjectURL(s),u=0>=(0,a._)(this,nq)?1:Math.ceil(s.size/(0,a._)(this,nq)),h=Math.ceil(u/(0,a._)(this,nU)),f=es(r,(0,a._)(this,nU)),p={id:eM(32),workerTotal:(0,d._)(this,n5,rl).call(this,f),customOption:o};(0,a._)(this,nQ)[p.id]=[];(0,d._)(this,n8,rs).call(this,{runWorkerBaseData:{uploadInfo:p,fileUrl:l,onProgress:i,resolve:t,reject:n},retryChunksMap:f,taskChunkSize:h,chunkTotal:u})}async function ru(e,t){let{onProgress:n=()=>{},chunkIdxs:r=[],customOption:i}=t;return new Promise((t,o)=>{(0,a._)(this,nJ).push({file:e,onProgress:n,chunkIdxs:r,resolve:t,reject:o,customOption:i}),(0,d._)(this,n9,ra).call(this)})}function rc(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(e){if(!e)throw TypeError("options 不能为空");if("object"!=typeof e)throw TypeError("options 必须是对象");if(!e.url&&"string"!==e.url)throw TypeError("options.url 必须是非空字符串");let{url:t,maxConcurrent:n,concurrentNode:r,chunkSize:i,dataType:o,dataKey:s,responseType:l,retryCount:a,requestMethod:u,headers:c,headersHandler:d,bodyHandler:h,requestOptions:f}=e,p=nN("dataType","string",o,"FormData",nL);return{url:t,maxConcurrent:nN("maxConcurrent","number",n,3),concurrentNode:nN("concurrentNode","string",r,"chunk",nF),chunkSize:nN("chunkSize","number",i,524288),dataType:p,dataKey:nN("dataKey","string",s,"file"),responseType:nN("responseType","string",l,"json",nM),retryCount:nN("retryCount","number",a,0),requestMethod:nN("requestMethod","string",u,"POST",nW),headers:nN("headers","object",c,{"Content-Type":"FormData"===p?"multipart/form-data":"application/octet-stream"}),headersHandler:nN("headersHandler",["function","asyncfunction"],d,()=>{}),bodyHandler:nN("bodyHandler",["function","asyncfunction"],h,()=>{}),requestOptions:nN("requestOptions","object",f,{})}}(e);return re.getInstance(n,t)}function rd(e){return"object"==typeof e&&null!==e}}}]);